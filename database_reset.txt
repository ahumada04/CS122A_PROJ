DROP DATABASE IF EXISTS cs122a;
CREATE DATABASE cs122a;
USE cs122a;

CREATE TABLE users (
	uid CHAR(8) NOT NULL,
	nickname VARCHAR(50) ,
	email VARCHAR(50) , 
	genres VARCHAR(255) , 
	street VARCHAR(50) ,
	city VARCHAR(50) ,
	state VARCHAR(2) ,
	zip CHAR(5) ,
	PRIMARY KEY (uid) );

CREATE TABLE producers (
	uid CHAR(8) NOT NULL,
	company VARCHAR(50) ,
	bio VARCHAR(255) ,
	PRIMARY KEY (uid),
	FOREIGN KEY (uid) REFERENCES Users(uid)  ON DELETE CASCADE );

CREATE TABLE viewer(
	uid CHAR(8) NOT NULL,
	firstname VARCHAR(50) ,
	lastname VARCHAR(50) ,
	subscription ENUM("free", "monthly", "yearly") NOT NULL,
	PRIMARY KEY (uid),
	FOREIGN KEY (uid) REFERENCES Users(uid) ON DELETE CASCADE );




-- Q2: Content Management (SQL DDL for entity(ies) table(s) only)

CREATE TABLE releases (
	rid CHAR(8) NOT NULL,
	uid CHAR(8) NOT NULL,
	release_date DATE ,
	title VARCHAR(50) ,
	genre VARCHAR(50) , 
	PRIMARY KEY (rid) ,
FOREIGN KEY (uid) REFERENCES Producers(uid) ON DELETE NO ACTION);

CREATE TABLE movies (
	rid CHAR(8) NOT NULL,
	website_url VARCHAR(255) ,
	PRIMARY KEY (rid),
	FOREIGN KEY (rid) REFERENCES Releases(rid) ON DELETE CASCADE );

CREATE TABLE series(
	rid CHAR(8) NOT NULL,
	introduction VARCHAR(255) ,
	PRIMARY KEY (rid),
	FOREIGN KEY (rid) REFERENCES Releases(rid) ON DELETE CASCADE );

CREATE TABLE videos(
	rid CHAR(8) NOT NULL,
	ep_num INTEGER NOT NULL,
	title VARCHAR(50) ,
	length TIME ,
	PRIMARY KEY (rid, ep_num),
	FOREIGN KEY (rid) REFERENCES Releases(rid) ON DELETE CASCADE );


-- Q3: Streaming Sessions (SQL DDL for entity(ies) table(s) only)

CREATE TABLE sessions(
	sid CHAR(8) NOT NULL,
	uid CHAR(8) NOT NULL,
	rid CHAR(8) NOT NULL,
	ep_num INTEGER NOT NULL,
	initiate_at DATETIME ,
	leave_at DATETIME ,
	quality ENUM("480p", "720p", "1080p") ,
	device ENUM("mobile", "desktop") , 
	PRIMARY KEY (sid),
	FOREIGN KEY (uid) REFERENCES Viewer(uid) ON DELETE NO ACTION, 
	FOREIGN KEY (rid, ep_num) REFERENCES Videos(rid, ep_num) 
ON DELETE NO ACTION );



-- Q4: Community Interactions (SQL DDL for entity(ies) table(s) only)

CREATE TABLE Reviews(
	rvid CHAR(8) NOT NULL,
	uid CHAR(8) NOT NULL,
	rid  CHAR(8) NOT NULL,
	posted_at VARCHAR(50),
	rating INTEGER,
	body VARCHAR(255), 
	PRIMARY KEY (rvid),
	FOREIGN KEY (uid) REFERENCES Viewer(uid),
	FOREIGN KEY (rid) REFERENCES Releases(rid) );
    """